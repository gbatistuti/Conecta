<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>Home | Lider</title>
<link rel="stylesheet" type="text/css" media="screen"
	th:href="@{/css/homeLider.css}" />

<script type="text/javascript" th:src="@{js/homeLider.js}"></script>

<!--Sera substituido pelo fragmento head que contem associaçoes para menu funcionar-->
<th:block th:replace="fragments/head :: head"></th:block>
</head>
<!--Sera substituido pelo fragmento do menu-->
<div th:replace="fragments/menuLider :: menu"></div>

<body onload="aberturaDoPopUp()" id="menuBody"
	style="background-image: url('img/menu/fundo1.png')">
	<div class="modal fade" id="avisoModal">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<h5>Aviso:</h5>
				</div>
				<div class="modal-body">
					<div th:if="${param.aprovado}">
						<p>Agendamento aprovado com sucesso!</p>
					</div>
					<div th:if="${param.reprovado}">
						<p>Agendamento reprovado com sucesso!</p>
					</div>
				</div>
				<div class="modal-footer">
					<button onclick="fecharPopUp" class="btn btn-default" value="Close"></button>
				</div>
			</div>
		</div>
	</div>
	<div id="content" class="row">
		<div class="aEsquerda col-lg-8">
			<div class="fundo">
				<h2>Agendamentos</h2>
				<div id="rolagemAgendamentos" class="rolagem">
					<table>
						<thead>
							<tr>
								<th>Cód.</th>
								<th>Título do Agendamento</th>
								<th>Descrição do Agendamento</th>
								<th>Projeto</th>
								<th>Produto</th>
								<th>Consultor</th>
								<th>Horas</th>
								<th>Candidatura</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="a : ${agendamento}">
								<td th:text="${a.idAgendamento}"></td>
								<td th:text="${a.pedido.titulo}"></td>
								<td th:text="${a.pedido.descricao}"></td>
								<td th:text="${a.pedido.projeto.nome}"></td>
								<td th:text="${a.pedido.projeto.produto}"></td>
								<td th:text="${a.disponivel.consultor.nome}"></td>
								<td th:text="${a.pedido.sugestaoDeHoras}"></td>
								<td th:text="(${a.pedido.candidatura} == true)? 'Sim' : 'Não'"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<div class="aDireita col-lg-4">
			<div class="row">
				<div id="fundoListaDeDisponibilidade" class="fundo">
					<h2>Lista de disponibilidade</h2>
					<div id="rolagemListaDisponibilidade" class="rolagem">
						<table>
							<thead>
								<tr>
									<th>Cód.</th>
									<th>Consultor</th>
									<th>Hora início</th>
									<th>Hora fim</th>
									<th>Créditos / h</th>
									<th>Habilidade Principal</th>
									<th>Habilidade Especifica</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="d : ${disponiveis}">
									<td th:text="${d.idDisponivel}"></td>
									<td th:text="${d.consultor.nome}"></td>
									<td th:text="${d.horaInicio}"></td>
									<td th:text="${d.horaFim}"></td>
									<td th:text="${d.consultor.creditosPorHora}"></td>
									<td>
										<table>
											<tbody>
												<tr th:each="h : ${d.consultor.habilidadesEspecificas}">
													<td
														th:text="${h.habilidadesPrincipais.nomeHabilidadePrincipal}"></td>
													<td th:text="${h.nomeHabilidadeEspecifica}"></td>
												</tr>
											</tbody>
										</table>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div>

				<div id="selecao" class="fundo painelInferiorQueTroca">
					<h2>Ações agendamento</h2>
					<button class="buttonAprovarERecusar botoes" id="buttonAprovar"
						onclick="abreAprovar()">Aprovar</button>
					<button class="buttonAprovarERecusar botoes" id="buttonRecusar"
						onclick="abreReprovar()">Reprovar</button>
				</div>

				<div id="aprovar" class="fundo painelInferiorQueTroca">
					<!-- parte para terminar e fazer a parte de aprovar e reprovar	-->
					<button class="botaoDeFechar" onclick="abreSeletor()">X</button>
					<h2>Aprovar</h2>
					<form action="/homeLider/aprovar" method="post"
						th:object="${alocacoes}">
						<div class="formulario">
							<label>Codigo do Agendamento</label> <br> <input name="agendamento" type="number" required oninvalid="this.setCustomValidity('Campo não pode ser vazio')" >
							<br> <label>Motivo</label> <br> <input name="motivo">
							<button type="submit">Enviar</button>
							<input type="hidden" th:name="${_csrf.parameterName}"
								th:value="${_csrf.token}" />
						</div>
						<div id="formulario"></div>
					</form>
				</div>

				<div id="reprovar" class="fundo painelInferiorQueTroca">
					<button class="botaoDeFechar" onclick="abreSeletor()">X</button>
					<h2>Reprovar</h2>
					<form action="/homeLider/reprovar" method="post"
						th:object="${recusado}">
						<div class="formulario">
							<label>Id do Agendamento</label><br>
							<input name="agendamento" required oninvalid="this.setCustomValidity('Campo não pode ser vazio')"  type="number"> 
							<label>Motivo:</label><br>
							<input name="motivo" required oninvalid="this.setCustomValidity('Campo não pode ser vazio')" >
							<button type="submit">Enviar</button>
						</div>
						<input type="hidden" th:name="${_csrf.parameterName}"
							th:value="${_csrf.token}" />
					</form>
				</div>
			</div>
		</div>

	</div>
	<script type="text/javascript">
		function abreAprovar() {
			var aprovar = document.getElementById("aprovar");
			var selecao = document.getElementById("selecao");
			aprovar.style.display = "block"
			selecao.style.display = "none"
		}

		function abreReprovar() {
			var reprovar = document.getElementById("reprovar");
			var selecao = document.getElementById("selecao");
			reprovar.style.display = "block"
			selecao.style.display = "none"
		}

		function abreSeletor() {
			var aprovar = document.getElementById("aprovar");
			var reprovar = document.getElementById("reprovar");
			var selecao = document.getElementById("selecao");
			aprovar.style.display = "none"
			reprovar.style.display = "none"
			selecao.style.display = "block"
		}

		function aberturaDoPopUp() {
			var url_atual = window.location.href

			var sucessoNaUrl = url_atual.indexOf("aprovado")
			var erroNaUrl = url_atual.indexOf("reprovado")

			var modal = document.getElementById('avisoModal')

			if (sucessoNaUrl != -1 || erroNaUrl != -1) {
				$("#avisoModal").modal('show');
			}
		}

		function fecharPopUp() {
			$("#avisoModal").modal('hide');
		}
	</script>
</body>
</html>